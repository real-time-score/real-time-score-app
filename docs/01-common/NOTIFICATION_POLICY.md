# 알림 권한 정책 (Notification Policy)

## 1. 개요

이 문서는 앱의 푸시 알림 권한 요청 및 마케팅 수신 동의 정책을 정의합니다.

- **원본 PDF 참조**: 9-11페이지 (알림 동의, 마케팅 동의)
- **적용 범위**: 앱 최초 실행, 설정

---

## 2. 알림 권한 요청 플로우

### 2.1 전체 플로우

```
앱 최초 실행
    ↓
스플래시 화면
    ↓
푸시 알림 권한 요청 (시스템 팝업)
    ↓
├── 허용 → 마케팅 수신 동의 팝업 표시
│           ↓
│   ├── 동의 → "마케팅 정보 수신에 동의하셨습니다" 토스트
│   └── 거부 → "마케팅 정보 수신을 거부하셨습니다" 토스트
│
└── 거부 → 메인 화면으로 이동
    ↓
메인 화면
```

### 2.2 권한 요청 시점

| 시점 | 동작 |
|------|------|
| 앱 최초 실행 | 자동으로 권한 요청 팝업 표시 |
| 권한 거부 후 재요청 | 설정에서 수동 활성화 필요 |
| 앱 재설치 | 권한 요청 다시 표시 |

---

## 3. 시스템 푸시 권한 팝업

### 3.1 iOS 시스템 팝업

```
┌──────────────────────────────────────┐
│                                      │
│     "스포츠스코어픽"이(가) 알림을    │
│     보내고자 합니다.                 │
│                                      │
│     알림에는 경고, 사운드 및         │
│     아이콘 배지가 포함될 수 있습니다.│
│                                      │
│   ┌──────────┐  ┌──────────┐        │
│   │ 허용 안 함│  │   허용   │        │
│   └──────────┘  └──────────┘        │
└──────────────────────────────────────┘
```

### 3.2 Android 시스템 팝업

```
┌──────────────────────────────────────┐
│                                      │
│     스포츠스코어픽에서 알림을        │
│     보내도록 허용하시겠습니까?       │
│                                      │
│   ┌──────────┐  ┌──────────┐        │
│   │   거부   │  │   허용   │        │
│   └──────────┘  └──────────┘        │
└──────────────────────────────────────┘
```

---

## 4. 알림 설정 안내 팝업 (앱 자체 팝업)

### 4.1 팝업 표시 조건

- 스플래시 화면 이후 표시
- OS 시스템 알림 권한 요청 전 앱 자체 안내 팝업

### 4.2 팝업 구성

```
┌──────────────────────────────────────┐
│░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░│
│░░┌────────────────────────────────┐░░│
│░░│                                │░░│
│░░│     서비스명 알림 설정 안내     │░░│
│░░│                                │░░│
│░░│  고객님을 위한 다양한 스포츠   │░░│
│░░│  추천 정보와 이벤트 알림을     │░░│
│░░│  받으시겠습니까?              │░░│
│░░│                                │░░│
│░░│  (수신동의는 MY 메뉴에서       │░░│
│░░│   변경 가능)                   │░░│
│░░│                                │░░│
│░░│  ┌──────────┐  ┌──────────┐   │░░│
│░░│  │  아니요  │  │ 알림받기 │   │░░│
│░░│  └──────────┘  └──────────┘   │░░│
│░░│                                │░░│
│░░└────────────────────────────────┘░░│
│░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░│
└──────────────────────────────────────┘
(░ = Dimmed 배경)
```

### 4.3 팝업 요소

| 요소 | 내용 |
|------|------|
| 타이틀 | 서비스명 알림 설정 안내 |
| 설명 | 고객님을 위한 다양한 스포츠 추천 정보와 이벤트 알림을 받으시겠습니까? |
| 부가 설명 | (수신동의는 MY 메뉴에서 변경 가능) |
| 버튼 1 | 아니요 (Secondary, 좌측) |
| 버튼 2 | 알림받기 (Primary, 우측, 네이비 배경) |

### 4.4 플로우

```
앱 자체 알림 안내 팝업
    ↓
├── "알림받기" 선택 → OS 시스템 알림 권한 요청 팝업 표시
│                      ↓
│               ├── 허용 → 메인 화면
│               └── 거부 → 메인 화면
│
└── "아니요" 선택 → 메인 화면으로 이동 (OS 권한 요청 스킵)
```

> **참고**: 알림 허용 OS 시스템 UI는 각 플랫폼(iOS/Android) 기본 UI 사용

---

## 5. 토스트 메시지

### 5.1 토스트 케이스

| 상황 | 메시지 |
|------|--------|
| 마케팅 동의 | "마케팅 정보 수신에 동의하셨습니다" |
| 마케팅 거부 | "마케팅 정보 수신을 거부하셨습니다" |

### 5.2 토스트 스타일

```
┌──────────────────────────────────────┐
│                                      │
│                                      │
│                                      │
│                                      │
│                                      │
│                                      │
│   ┌──────────────────────────────┐   │
│   │ 마케팅 정보 수신에 동의하셨습니다 │   │
│   └──────────────────────────────┘   │
│                                      │
│ ┌──────┬──────────┬──────────┬──────┬────┐ │
│ │  홈  │ 픽전문가 │ 커뮤니티 │ 랭킹 │ MY │ │
│ └──────┴──────────┴──────────┴──────┴────┘ │
└──────────────────────────────────────┘
```

| 속성 | 값 |
|------|-----|
| 위치 | 하단 탭 바 위 |
| 배경색 | 어두운 색 (반투명) |
| 텍스트 색 | 흰색 |
| 표시 시간 | 2-3초 |

---

## 6. 설정에서 변경

### 6.1 설정 > 알림 설정

```
┌──────────────────────────────────────┐
│ ←  알림 설정                         │
├──────────────────────────────────────┤
│                                      │
│ 푸시 알림                      [ON]  │
│ 앱 푸시 알림을 받습니다              │
│                                      │
│──────────────────────────────────────│
│                                      │
│ 마케팅 정보 수신                [OFF]│
│ 이벤트, 프로모션 정보를 받습니다     │
│                                      │
│──────────────────────────────────────│
│                                      │
│ 경기 시작 알림                  [ON] │
│ 관심 경기 시작 시 알림을 받습니다    │
│                                      │
│──────────────────────────────────────│
│                                      │
│ 픽 결과 알림                    [ON] │
│ 구매한 픽 결과를 알림으로 받습니다   │
│                                      │
└──────────────────────────────────────┘
```

### 6.2 토글 변경 시 동작

| 항목 | ON 변경 시 | OFF 변경 시 |
|------|-----------|-------------|
| 푸시 알림 | 시스템 설정 이동 안내 | 확인 모달 표시 |
| 마케팅 정보 | 동의 토스트 | 거부 토스트 |
| 경기 시작 알림 | 즉시 적용 | 즉시 적용 |
| 픽 결과 알림 | 즉시 적용 | 즉시 적용 |

---

## 7. 데이터 요구사항

### 7.1 알림 설정 데이터

```typescript
interface NotificationSettings {
  userId: string;
  pushEnabled: boolean;           // 푸시 알림 활성화
  marketingEnabled: boolean;      // 마케팅 수신 동의
  matchStartEnabled: boolean;     // 경기 시작 알림
  pickResultEnabled: boolean;     // 픽 결과 알림
  marketingConsentDate?: Date;    // 마케팅 동의/거부 일시
  marketingConsentHistory: ConsentHistory[];  // 동의 이력
}

interface ConsentHistory {
  type: 'marketing';
  status: 'agree' | 'disagree';
  timestamp: Date;
  method: 'popup' | 'settings';   // 동의 방식
}
```

---

## 8. API 요구사항

### 8.1 알림 설정 API

| 엔드포인트 | 메서드 | 설명 |
|-----------|--------|------|
| `/api/user/notification-settings` | GET | 알림 설정 조회 |
| `/api/user/notification-settings` | PUT | 알림 설정 변경 |
| `/api/user/marketing-consent` | POST | 마케팅 동의 기록 |

### 8.2 마케팅 동의 기록 Request

```json
{
  "status": "agree",
  "method": "popup"
}
```

### 8.3 마케팅 동의 기록 Response

```json
{
  "success": true,
  "data": {
    "marketingEnabled": true,
    "consentDate": "2025-12-22T10:30:00Z"
  }
}
```

---

## 9. 관리자 기능

| 항목 | 관리 필요 | 설명 |
|------|----------|------|
| 마케팅 동의 현황 | O | 동의/거부 사용자 통계 |
| 동의 이력 조회 | O | 사용자별 동의 변경 이력 |
| 마케팅 푸시 발송 | O | 동의 사용자 대상 발송 |

### 9.1 Admin API 요구사항

| 엔드포인트 | 메서드 | 설명 |
|-----------|--------|------|
| `/admin/api/marketing/statistics` | GET | 마케팅 동의 통계 조회 |
| `/admin/api/marketing/users` | GET | 마케팅 동의 사용자 목록 |
| `/admin/api/user/:id/consent-history` | GET | 사용자 동의 이력 조회 |

### 9.2 통계 데이터

```json
{
  "totalUsers": 10000,
  "marketingAgreed": 6500,
  "marketingDisagreed": 3500,
  "agreementRate": 65.0,
  "recentChanges": {
    "today": { "agreed": 50, "disagreed": 10 },
    "week": { "agreed": 300, "disagreed": 80 }
  }
}
```

---

## 10. 법적 준수 사항

### 10.1 개인정보보호법 준수

- 마케팅 수신 동의는 **선택적**으로 운영
- 동의 철회는 언제든 가능하도록 설정 메뉴 제공
- 동의/철회 이력 보관 (최소 3년)

### 10.2 동의 증빙 데이터

| 필드 | 설명 | 필수 |
|------|------|------|
| userId | 사용자 식별자 | O |
| consentType | 동의 유형 (marketing) | O |
| status | 동의/거부 상태 | O |
| timestamp | 동의 일시 | O |
| method | 동의 방식 (popup/settings) | O |
| appVersion | 앱 버전 | O |
| deviceInfo | 디바이스 정보 | △ |

---

## 11. 버전 관리

| 버전 | 날짜 | 변경 내용 |
|------|------|----------|
| v0.1 | 2025-12-22 | 초기 작성 |
| v0.2 | 2025-12-23 | 디자인 이미지 기반 알림 안내 팝업 업데이트 |
