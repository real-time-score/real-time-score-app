# 포인트 시스템

## 1. 개요

사용자의 크레딧(포인트) 잔액 확인, 충전, 사용 내역 조회 기능을 제공합니다. 크레딧은 유료 픽 구매 등에 사용됩니다.

**원본 PDF 참조**: 72-73페이지

---

## 2. 포인트 화면 (페이지 72)

### 2.1 화면 구성

```
┌─────────────────────────────────────┐
│ ←         포인트                    │  ← 헤더
├─────────────────────────────────────┤
│                                     │
│            NNN,NNN                  │  ← 보유 포인트 (큰 숫자)
│                                     │
├─────────────────────────────────────┤
│     [충전]          포인트 내역      │  ← 탭 (활성: 네이비 배경)
├─────────────────────────────────────┤
│                                     │
│  충전 금액                          │
│                                     │
│  ┌─────────┐  ┌─────────┐          │
│  │ 5,000원 │  │10,000원 │          │
│  └─────────┘  └─────────┘          │
│                                     │
│  ┌─────────┐  ┌─────────┐          │
│  │50,000원 │  │         │          │
│  └─────────┘  └─────────┘          │
│                                     │
├─────────────────────────────────────┤
│                                     │
│        [ 충전하기 ]                 │  ← 네이비 버튼
│                                     │
└─────────────────────────────────────┘
```

### 2.1.1 포인트 내역 탭

```
┌─────────────────────────────────────┐
│ ←         포인트                    │  ← 헤더
├─────────────────────────────────────┤
│                                     │
│            NNN,NNN                  │  ← 보유 포인트
│                                     │
├─────────────────────────────────────┤
│      충전          [포인트 내역]     │  ← 탭
├─────────────────────────────────────┤
│  [전체] [충전] [사용] [적립]        │  ← 서브 필터
├─────────────────────────────────────┤
│                                     │
│  2025년 1월                         │
│                                     │
│  ┌─────────────────────────────┐    │
│  │ 🔵 유료 픽 구매              │    │
│  │ 픽마스터 - EPL 경기 픽      │    │
│  │ -100C            01.20 15:30│    │
│  └─────────────────────────────┘    │
│                                     │
│  ┌─────────────────────────────┐    │
│  │ 🟢 크레딧 충전               │    │
│  │ 5,000원 → 500C              │    │
│  │ +500C            01.18 10:00│    │
│  └─────────────────────────────┘    │
│                                     │
│  ┌─────────────────────────────┐    │
│  │ 🟡 픽 적중 보너스            │    │
│  │ EPL 경기 픽 적중            │    │
│  │ +50C             01.17 22:00│    │
│  └─────────────────────────────┘    │
│                                     │
│  ┌─────────────────────────────┐    │
│  │ 🔵 유료 픽 구매              │    │
│  │ 분석왕 - 라리가 경기 픽     │    │
│  │ -150C            01.15 14:00│    │
│  └─────────────────────────────┘    │
│                                     │
│  ────────────── 더 보기 ──────────  │
│                                     │
└─────────────────────────────────────┘
```

### 2.2 상단 잔액 영역

| 요소 | 설명 |
|------|------|
| 보유 크레딧 | 현재 잔액 표시 (숫자 + C 단위) |
| 충전하기 버튼 | 충전 화면으로 이동 |

### 2.3 내역 필터 탭

| 필터 | 표시 내용 |
|------|----------|
| 전체 | 모든 크레딧 내역 |
| 충전 | 크레딧 충전 내역만 |
| 사용 | 크레딧 사용 내역만 |
| 적립 | 보너스/이벤트 적립 내역만 |

### 2.4 내역 항목 구성

| 요소 | 설명 |
|------|------|
| 유형 아이콘 | 🔵 사용, 🟢 충전, 🟡 적립 |
| 제목 | 내역 유형 (유료 픽 구매, 크레딧 충전 등) |
| 상세 | 상세 내용 (픽 이름, 충전 금액 등) |
| 금액 | +/- 크레딧 변동량 |
| 일시 | MM.DD HH:mm 형식 |

### 2.5 월별 그룹핑

- 내역은 월별로 그룹화하여 표시
- 최신 월부터 과거 순으로 정렬
- 무한 스크롤로 추가 데이터 로드

---

## 3. 충전하기 화면 (페이지 73)

### 3.1 화면 구성

```
┌─────────────────────────────────────┐
│ [←]       충전하기                  │
├─────────────────────────────────────┤
│                                     │
│  현재 보유 크레딧                   │
│  1,234 C                            │
│                                     │
├─────────────────────────────────────┤
│                                     │
│  충전할 금액을 선택하세요           │
│                                     │
│  ┌─────────┐  ┌─────────┐          │
│  │ 1,000원 │  │ 3,000원 │          │
│  │  100C   │  │  300C   │          │
│  └─────────┘  └─────────┘          │
│                                     │
│  ┌─────────┐  ┌─────────┐          │
│  │ 5,000원 │  │10,000원 │          │
│  │  500C   │  │ 1,000C  │          │
│  └─────────┘  └─────────┘          │
│                                     │
│  ┌─────────┐  ┌─────────┐          │
│  │30,000원 │  │50,000원 │          │
│  │ 3,000C  │  │ 5,000C  │          │
│  │ +300C   │  │ +500C   │          │
│  └─────────┘  └─────────┘          │
│                                     │
│  ┌─────────────────────────────┐    │
│  │ 100,000원                    │    │
│  │ 10,000C + 1,000C 보너스      │    │
│  └─────────────────────────────┘    │
│                                     │
├─────────────────────────────────────┤
│                                     │
│  결제 수단                          │
│                                     │
│  ○ Google Pay                       │
│  ○ Apple Pay                        │
│  ○ 신용카드                         │
│                                     │
├─────────────────────────────────────┤
│                                     │
│  ┌─────────────────────────────┐    │
│  │    5,000원 결제하기          │    │
│  └─────────────────────────────┘    │
│                                     │
│  * 크레딧은 환불되지 않습니다       │
│  * 결제 취소는 7일 이내 가능합니다  │
│                                     │
└─────────────────────────────────────┘
```

### 3.2 충전 상품

**✅ 확정 정책 (2026-01-06)**: 스토어 측에서 별도 상품 구성이 필요할 경우, 1만 엔/2만 엔 단위 상품 추가 구성 가능

| 결제 금액 | 기본 크레딧 | 보너스 | 총 지급 |
|----------|-----------|--------|--------|
| 1,000원 | 100C | - | 100C |
| 3,000원 | 300C | - | 300C |
| 5,000원 | 500C | - | 500C |
| 10,000원 | 1,000C | - | 1,000C |
| 30,000원 | 3,000C | +300C (10%) | 3,300C |
| 50,000원 | 5,000C | +500C (10%) | 5,500C |
| 100,000원 | 10,000C | +1,000C (10%) | 11,000C |

> **일본 출시 참고**: 스토어 요구사항에 따라 ¥10,000, ¥20,000 단위 상품 추가 가능

### 3.3 결제 수단

| 결제 수단 | 플랫폼 | 설명 |
|----------|--------|------|
| Google Pay | Android | Google Play 결제 |
| Apple Pay | iOS | App Store 인앱 결제 |
| 신용카드 | 공통 | PG사 연동 카드 결제 |

### 3.4 결제 플로우

```
1. 충전 금액 선택
2. 결제 수단 선택
3. 결제하기 버튼 탭
4. 결제 모듈 호출 (Google/Apple/PG)
5. 결제 완료
6. 크레딧 즉시 충전
7. 충전 완료 모달 표시
8. 포인트 화면으로 복귀
```

---

## 4. 크레딧 적립 정책

### 4.1 적립 유형

| 유형 | 적립량 | 조건 |
|------|--------|------|
| 픽 적중 보너스 | +10~100C | 등록한 픽 적중 시 (적중률 기반) |
| 출석 보너스 | +5C | 매일 첫 접속 시 |
| 연속 출석 보너스 | +10~50C | 7일/30일 연속 출석 |
| 이벤트 적립 | 다양 | 이벤트 조건 충족 시 |
| 추천인 보너스 | +100C | 추천 코드로 신규 가입 시 |
| 리뷰 작성 보너스 | +50C | 픽 리뷰 작성 시 |

### 4.2 사용처

| 사용처 | 사용량 | 설명 |
|--------|--------|------|
| 유료 픽 구매 | 50~500C | 전문가 유료 픽 구매 |
| 프리미엄 기능 | 다양 | 추가 기능 이용 |

---

## 5. 데이터 요구사항

### 5.1 크레딧 잔액

```typescript
interface CreditBalance {
  userId: string;
  balance: number;           // 현재 잔액
  totalCharged: number;      // 총 충전 금액
  totalUsed: number;         // 총 사용 금액
  totalEarned: number;       // 총 적립 금액
  updatedAt: string;
}
```

### 5.2 크레딧 내역

```typescript
interface CreditHistory {
  id: string;
  userId: string;
  type: 'charge' | 'use' | 'earn' | 'refund' | 'expire';
  category: CreditCategory;
  amount: number;            // 양수: 적립/충전, 음수: 사용
  balance: number;           // 거래 후 잔액
  title: string;
  description: string;
  referenceId?: string;      // 관련 ID (픽 ID, 주문 ID 등)
  createdAt: string;
}

type CreditCategory =
  | 'pick_purchase'          // 픽 구매
  | 'pick_bonus'             // 픽 적중 보너스
  | 'credit_charge'          // 크레딧 충전
  | 'attendance_bonus'       // 출석 보너스
  | 'event_reward'           // 이벤트 보상
  | 'referral_bonus'         // 추천인 보너스
  | 'review_bonus'           // 리뷰 보너스
  | 'admin_adjustment'       // 관리자 조정
  | 'refund'                 // 환불
  | 'expiration';            // 만료
```

### 5.3 충전 상품

```typescript
interface ChargeProduct {
  id: string;
  price: number;             // 결제 금액 (원)
  baseCredit: number;        // 기본 지급 크레딧
  bonusCredit: number;       // 보너스 크레딧
  totalCredit: number;       // 총 지급 크레딧
  bonusRate: number;         // 보너스 비율 (%)
  isActive: boolean;
  sortOrder: number;
}
```

### 5.4 결제 내역

```typescript
interface PaymentHistory {
  id: string;
  userId: string;
  productId: string;
  paymentMethod: 'google_pay' | 'apple_pay' | 'credit_card';
  amount: number;            // 결제 금액
  creditAmount: number;      // 지급된 크레딧
  status: 'pending' | 'completed' | 'failed' | 'refunded' | 'cancelled';
  transactionId: string;     // 외부 거래 ID
  receiptUrl?: string;       // 영수증 URL
  createdAt: string;
  completedAt?: string;
}
```

---

## 6. API 요구사항

### 6.1 크레딧 잔액 조회

```
GET /api/v1/credits/balance
```

**Response**
```json
{
  "balance": 1234,
  "totalCharged": 50000,
  "totalUsed": 48766,
  "totalEarned": 500
}
```

### 6.2 크레딧 내역 조회

```
GET /api/v1/credits/history?type={type}&page={page}&limit={limit}
```

**Response**
```json
{
  "history": [
    {
      "id": "ch_123",
      "type": "use",
      "category": "pick_purchase",
      "amount": -100,
      "balance": 1134,
      "title": "유료 픽 구매",
      "description": "픽마스터 - EPL 경기 픽",
      "referenceId": "pick_456",
      "createdAt": "2025-01-20T15:30:00Z"
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 20,
    "totalCount": 45
  }
}
```

### 6.3 충전 상품 목록 조회

```
GET /api/v1/credits/products
```

**Response**
```json
{
  "products": [
    {
      "id": "prod_1000",
      "price": 1000,
      "baseCredit": 100,
      "bonusCredit": 0,
      "totalCredit": 100,
      "bonusRate": 0
    },
    {
      "id": "prod_30000",
      "price": 30000,
      "baseCredit": 3000,
      "bonusCredit": 300,
      "totalCredit": 3300,
      "bonusRate": 10
    }
  ]
}
```

### 6.4 결제 요청

```
POST /api/v1/credits/charge
```

**Request**
```json
{
  "productId": "prod_5000",
  "paymentMethod": "google_pay"
}
```

**Response**
```json
{
  "orderId": "order_123",
  "paymentToken": "token_xxx",
  "amount": 5000,
  "redirectUrl": "..."
}
```

### 6.5 결제 완료 확인

```
POST /api/v1/credits/charge/confirm
```

**Request**
```json
{
  "orderId": "order_123",
  "transactionId": "txn_xxx"
}
```

**Response**
```json
{
  "success": true,
  "creditBalance": 1734,
  "chargedCredit": 500
}
```

### 6.6 결제 내역 조회

```
GET /api/v1/payments?page={page}&limit={limit}
```

---

## 7. 관리자 기능

### 7.1 충전 상품 관리

| 기능 | 설명 |
|------|------|
| 상품 CRUD | 충전 상품 생성/수정/삭제 |
| 보너스율 설정 | 상품별 보너스 크레딧 설정 |
| 상품 순서 변경 | 노출 순서 조정 |
| 상품 활성/비활성 | 상품 판매 상태 관리 |

### 7.2 크레딧 관리

| 기능 | 설명 |
|------|------|
| 잔액 조회 | 사용자별 크레딧 잔액 조회 |
| 수동 지급 | 이벤트/보상 크레딧 수동 지급 |
| 수동 차감 | 오류 수정 등을 위한 수동 차감 |
| 내역 조회 | 사용자별 전체 거래 내역 조회 |

### 7.3 결제 관리

| 기능 | 설명 |
|------|------|
| 결제 내역 조회 | 전체 결제 내역 조회 |
| 결제 취소 | 결제 취소 처리 (7일 이내) |
| 환불 처리 | 환불 요청 처리 |
| 결제 통계 | 일/주/월별 매출 통계 |

### 7.4 정책 관리

| 기능 | 설명 |
|------|------|
| 적립 정책 설정 | 적립 유형별 적립량 설정 |
| 만료 정책 설정 | 크레딧 유효기간 설정 |
| 사용 제한 설정 | 일일/월간 사용 한도 설정 |

### 7.5 필요 API (Admin)

```
# 충전 상품 관리
GET    /api/admin/credits/products
POST   /api/admin/credits/products
PUT    /api/admin/credits/products/{productId}
DELETE /api/admin/credits/products/{productId}
PUT    /api/admin/credits/products/order

# 크레딧 관리
GET    /api/admin/users/{userId}/credits/balance
POST   /api/admin/users/{userId}/credits/adjust
GET    /api/admin/users/{userId}/credits/history
GET    /api/admin/credits/statistics

# 결제 관리
GET    /api/admin/payments
GET    /api/admin/payments/{paymentId}
POST   /api/admin/payments/{paymentId}/cancel
POST   /api/admin/payments/{paymentId}/refund
GET    /api/admin/payments/statistics

# 정책 관리
GET    /api/admin/credits/policies
PUT    /api/admin/credits/policies
```

---

## 8. 비즈니스 로직

### 8.1 크레딧 충전 플로우

```
1. 사용자가 충전 상품 선택
2. 결제 수단 선택
3. 결제 모듈 호출
4. 결제사 결제 처리
5. 결제 완료 콜백 수신
6. 크레딧 잔액 업데이트
7. 충전 내역 기록
8. 알림 발송 (선택)
9. 충전 완료 화면 표시
```

### 8.2 크레딧 사용 플로우

```
1. 사용 요청 (픽 구매 등)
2. 잔액 확인
3. 잔액 부족 시 충전 유도
4. 잔액 충분 시 크레딧 차감
5. 사용 내역 기록
6. 서비스 제공 (픽 열람 등)
```

### 8.3 크레딧 만료 정책

**✅ 확정 정책 (2026-01-06)**:

```
- 충전 크레딧: 결제일로부터 1년 후 만료
- 적립 크레딧: 적립일로부터 1년 후 만료 (통일)
- Admin 수동 지급 크레딧: 지급일로부터 1년 후 만료
- 만료 30일 전 알림 발송
- 만료 7일 전 재알림 발송
- 만료일에 자동 소멸 처리
```

> **참고**: 추후 필요 시 정책 변경 가능 (Admin에서 설정 변경)

### 8.4 환불 정책

```
- 충전 후 7일 이내 미사용 크레딧 환불 가능
- 부분 환불 불가 (전액 환불만 가능)
- 보너스 크레딧 환불 불가
- 이미 사용한 크레딧 환불 불가
```

---

## 9. 화면 전환

| 액션 | 이동 화면 |
|------|----------|
| 충전하기 버튼 탭 | 충전하기 화면 |
| 내역 항목 탭 (픽 구매) | 픽 상세 화면 |
| 결제하기 버튼 탭 | 결제 모듈 (외부) |
| 결제 완료 | 충전 완료 모달 → 포인트 화면 |

---

## 10. 에러 처리

### 10.1 결제 실패

| 에러 유형 | 처리 방식 |
|----------|----------|
| 잔액 부족 | "잔액이 부족합니다" 메시지 표시 |
| 결제 취소 | 이전 화면으로 복귀 |
| 결제사 오류 | "결제에 실패했습니다. 다시 시도해주세요" |
| 네트워크 오류 | 재시도 안내 |

### 10.2 크레딧 사용 실패

| 에러 유형 | 처리 방식 |
|----------|----------|
| 잔액 부족 | 충전 화면으로 이동 유도 |
| 서버 오류 | 에러 메시지 표시 |
| 이미 구매함 | "이미 구매한 픽입니다" 메시지 |
